# Dual-stage Artificial Neural Surrogate

This project implements neural network-based surrogate modeling for gravitational wave signals, specifically focusing on 22-mode waveform approximation.

## Project Structure

```
.
├── data/                           # Dataset storage (excluded from git)
├── scripts/                       # Main scripts package
│   ├── __init__.py
│   ├── surrogate/                 # Surrogate model implementations
│   │   ├── __init__.py
│   │   ├── sur_utils.py          # DANSur surrogate evaluator
│   │   ├── waveform_generation.py # Waveform generation utilities
│   │   ├── timing.py             # Performance timing utilities
│   │   ├── create_jit_model.py   # JIT model creation
│   │   └── DANSur.pt             # Torchscript-ready model
│   ├── training/                   # Training scripts
│   │   ├── __init__.py
│   │   ├── pretrain_22.py        # Pretraining script
│   │   ├── train_decoder_ensemble.py # Decoder ensemble training
│   │   ├── sxs_finetune.py      # SXS fine-tuning
│   │   ├── sxs_finetune_kfold.py # SXS k-fold cross-validation
│   │   └── comparison.py        # Model comparison utilities
│   └── utils/                      # Common utilities
│       ├── __init__.py
│       ├── common.py             # Shared functions and classes
│       ├── utils.py              # General utilities
│       └── sxs_utils.py          # SXS-specific utilities
├── pyproject.toml                 # UV package configuration
└── requirements.txt               # Generated by uv from pyproject.toml
```

## Setup

### Option 1: Using UV (Recommended)

```bash
# Install UV (if not already installed)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Install dependencies from pyproject.toml
uv sync

# Activate the virtual environment
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
```

### Option 2: Using pip

```bash
# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

## Usage

### Waveform Generation

To generate waveforms using the DANSur surrogate:

```python
# Option 1: Direct import
from scripts.surrogate.sur_utils import DANSur

# Option 2: Via package import (requires dependencies to be installed)
from scripts.surrogate import DANSur

# Initialize the surrogate model
surrogate = DANSur(device='cuda')

# Generate waveform for given parameters
q = 2.0  # mass ratio
chi1 = [0, 0, 0.5]  # spin of primary black hole
chi2 = [0, 0, -0.3]  # spin of secondary black hole
times = np.arange(-4096+100, 100, 2)

# Generate waveform
waveform = surrogate(q, chi1, chi2, f_low=0, times=times)
```

### Training

#### Pretraining
```bash
python -m scripts.training.pretrain_22 --approximant (NRSur7dq4 | NRHybSur3dq8 | SEOBNRv5HM | SEOBNRv4HM_PA | IMRPhenomTHM)
```

#### Fine-tuning
```bash
python -m scripts.training.sxs_finetune_kfold --approximant (NRSur7dq4 | NRHybSur3dq8 | SEOBNRv5HM | SEOBNRv4HM_PA | IMRPhenomTHM)
```

### Performance Comparison

Compare performance with other surrogate models:
```bash
python -m scripts.surrogate.timing
```

## Development

### Code Organization

The project has been reorganized for better maintainability:

- **surrogate/**: Contains the main surrogate model implementation and waveform generation
- **training/**: Contains all training-related scripts and utilities
- **utils/**: Contains shared utilities and common functions

### Common Utilities

Duplicate functions have been consolidated into `scripts/utils/common.py` to avoid code duplication across the project.

### Package Management

The project now uses UV for modern Python package management. The `pyproject.toml` file contains all dependencies and project metadata.

## Project Details

This project uses:
- Neural network surrogates for gravitational wave signal approximation
- K-fold cross-validation for model training
- Custom loss functions for waveform optimization
- PyTorch for deep learning implementation

Results are published in [arXiv:2412.06946](https://arxiv.org/abs/2412.06946)

## License

This project is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit <http://creativecommons.org/licenses/by/4.0/>.
